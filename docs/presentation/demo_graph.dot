digraph DemoFlow {
  rankdir=TB;
  splines=true;
  nodesep=0.4;
  ranksep=0.6;

  // Default node styles
  node [fontname="Helvetica", fontsize=11, style=rounded];

  // Define simple styling by type
  subgraph cluster_legend {
    label="Legend"; fontsize=10; color=gray90; style=dashed;
    keyE [label="Entity (prov:Entity, odim:*)", shape=box];
    keyA [label="Activity (prov:Activity, odim:Computation)", shape=ellipse];
  }

  // Raw entities (prov:Entity)
  subgraph cluster_raw {
    label="Raw (prov:Entity)"; style=dashed; color=gray60;
    RawSteps [label="odim:RawStepsCSV\n(prov:Entity)", shape=box];
    RawSleep [label="odim:RawSleepCSV\n(prov:Entity)", shape=box];
  }

  // Import activity
  subgraph cluster_import {
    label="Import (odim:DataTransferEvent)"; style=dashed; color=gray60;
    Import [label="odim:A_Import\n(odim:DataTransferEvent)", shape=ellipse];
  }

  // Observations (entities)
  subgraph cluster_obs {
    label="Observations (SOSA/ODIM entities)"; style=dashed; color=gray60;
    ObsSteps [label="odim:Obs_Steps_D1\n(odim:ActivityMeasurement)", shape=box];
    ObsSleep [label="odim:Obs_Sleep_D1\n(odim:SleepStageMeasurement)", shape=box];
    ObsDots  [label="… (D2..D7)", shape=plaintext];
  }

  // Daily computation + features
  subgraph cluster_daily {
    label="Daily features (DerivedFeature)"; style=dashed; color=gray60;
    DailyComp [label="odim:A_DailySummary\n(odim:AlgorithmicComputation)", shape=ellipse];
    F1 [label="odim:F_DailySteps_D1\n(odim:DerivedFeature)", shape=box];
    F2 [label="odim:F_DailySteps_D2\n(odim:DerivedFeature)", shape=box];
    FDots [label="… (D3..D7)", shape=plaintext];
  }

  // Weekly aggregation + marker
  subgraph cluster_weekly {
    label="Weekly decision (DerivedFeature + context)"; style=dashed; color=gray60;
    WeeklyComp [label="odim:A_WeeklyAggregate\n(odim:AlgorithmicComputation)", shape=ellipse];
    Marker [label="odim:Marker_LowActivityDuringTravel\n(odim:DerivedFeature)", shape=box, style="rounded,bold"];
    Week [label="odim:Week1\n(odim:WeeklyInterval)", shape=box];
  }

  // Edges with exact predicates
  // Import used raw files (prov:used: Activity -> Entity)
  Import -> RawSteps [label="prov:used", fontsize=10];
  Import -> RawSleep [label="prov:used", fontsize=10];

  // Observations were generated by Import (odim:wasGeneratedBy: Entity -> Activity)
  ObsSteps -> Import [label="odim:wasGeneratedBy", fontsize=10];
  ObsSleep -> Import [label="odim:wasGeneratedBy", fontsize=10];
  {rank=same; ObsSteps; ObsSleep;}

  // Daily computation used observations (prov:used)
  DailyComp -> ObsSteps [label="prov:used", fontsize=10];
  DailyComp -> ObsSleep [label="prov:used", fontsize=10];

  // Daily features were computed by DailyComp (odim:wasComputedBy: Entity -> Activity)
  F1 -> DailyComp [label="odim:wasComputedBy", fontsize=10];
  F2 -> DailyComp [label="odim:wasComputedBy", fontsize=10];
  FDots -> DailyComp [style=dotted, arrowhead=none];

  // Weekly computation used daily features (prov:used)
  WeeklyComp -> F1 [label="prov:used", fontsize=10];
  WeeklyComp -> F2 [label="prov:used", fontsize=10];
  WeeklyComp -> FDots [style=dotted, arrowhead=none];

  // Marker was computed by WeeklyComp, and occursDuring Week1
  Marker -> WeeklyComp [label="odim:wasComputedBy", fontsize=10];
  Marker -> Week [label="odim:occursDuring", fontsize=10];
}
